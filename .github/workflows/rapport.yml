Test_Car:
  runs-on: ubuntu-latest
  needs: Compilation
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Build
      run: |
        mkdir -p build
        cd build
        cmake ..
        make

    - name: Run test "car" and capture report
      run: |
        cd build
        set -e
        echo "== Test car 7 ==" > report.txt
        ./src/calculator car 7 | tee -a report.txt
        echo "Exit code: $?" >> report.txt

    - name: Upload report as artifact
      uses: actions/upload-artifact@v4
      with:
        name: test-car-report
        path: build/report.txt
        retention-days: 14

    - name: Job summary
      run: |
        echo "### Résultat du test *car* (fonction carré)" >> $GITHUB_STEP_SUMMARY
        echo '' >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        cat build/report.txt >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
